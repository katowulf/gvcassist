rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    function newDocAndOwner() {
       return resource.data.size() == 0 && request.auth.uid in request.resource.data.get('owners')
    }

    function currentDocOwner() {
       return request.auth.uid in resource.data.get('owners');
    }

    match /publicProfiles/{uid} {
        allow get: if request.auth.uid != null;
    }

    match /privateProfiles/{uid} {
        allow get: if request.auth.uid == uid;
    }

    match /rooms/{roomId} {
        allow read: if request.auth.uid in resource.data.get('owners');
        allow write: if newDocAndOwner() || currentDocOwner();
    }
  }
}